language: go

go:
#  - "1.10.x"
  - "1.11.x"
  - master

before_install:
  - go get github.com/onsi/ginkgo/ginkgo
#  - curl https://glide.sh/get | sh
  - go get k8s.io/code-generator/cmd/client-gen && git -C "${GOPATH}/src/k8s.io/code-generator" checkout kubernetes-1.12.1
  - cp test_files/flexy/unit.test.files/gce.json /tmp/

script:
  - echo "${GOPATH}"
  - go version
  - ginkgo version
#  - glide --version
#  - glide up -v
  - env GO111MODULE=on make build-flexy
  - env GO111MODULE=on make test-flexy
  - make code-gen
  - env GO111MODULE=on make build-code-gen
  - env GO111MODULE=on make build-http
  - env GO111MODULE=on make test-pb

after_success:
  - env GO111MODULE=on make RELEASE=${RELEASE} GH_TOKEN=${GH_TOKEN} TRAVIS="${TRAVIS}" TRAVIS_BUILD_NUMBER="${TRAVIS_BUILD_NUMBER}" TRAVIS_BUILD_ID="${TRAVIS_BUILD_ID}" TRAVIS_JOB_NUMBER="${TRAVIS_JOB_NUMBER}" release-flexy
